"use strict";

document.addEventListener("DOMcontentLoaded", function(){
    document.body.addEventListener("touchstart", playVideo);
    function playVideo(){
        const video = document.getElementById('myVideo');
        if(video.playing){

        }else{
            video.play();
        }
    }
});

let dw = {};


dw.settings = {
    on_scroll_animation: true,
    preloader: true,
    custom_cursor: true
};


if (dw.settings.preloader) {
    $("body").css("overflow", "hidden");


    let perf_data = window.performance.timing;
    let est_time = -(perf_data.loadEventEnd - perf_data.navigationStart);
    let total_time = ((est_time / 1000) % 10) * 50;
    let current = 0;
    let increment = 100 > 0 ? 1 : -1;
    let step_time = Math.abs(Math.floor(total_time / 100));
    let timer = setInterval(function () {
        current += increment;
        $(".preloader-percentage").html(current);
        if (current === 100) {
            clearInterval(timer);
        }
    }, step_time);
    setTimeout(function () {
        $('body').waitForImages(function () {
            setTimeout(function () {
                $(".preloader-percentage").addClass("loaded");
            }, 400);
            setTimeout(function () {
                $("#preloader-wrapper").addClass("loaded");
            }, 600);
        });
    }, total_time + 100);
}


(function ($) {

    let $window = $(window);
    let $document = $(document);
    let $html = $("html, body");


    let page_has_three = false;


    let document_width;
    let window_width;
    let window_height = window.innerHeight;




    $(window).on('resize', function () {
        window_width = $(window).width();
        document_width = $(document).width();
    });


    


    dw.team_slider = function () {
        let $team_slider_section = $("#our-crew");
        if ($team_slider_section.length) {
            let $slider = $team_slider_section.find(".crew-slider");
            $slider.on("init", function () {
                $slider.find(".slick-active").addClass("slick-next-active");
            });
            $slider.slick({
                centerMode: true,
                centerPadding: '280px',
                infinite: true,
                slidesToShow: 1,
                prevArrow: $('.crew-slider-prev-arrow'),
                nextArrow: $('.crew-slider-next-arrow'),
                responsive: [
                    {
                        breakpoint: 1024,
                        settings: {
                            slidesToShow: 1,
                            infinite: true,
                            centerMode: true,
                            centerPadding: '100px',
                        }
                    },
                    {
                        breakpoint: 940,
                        settings: {
                            slidesToShow: 1,
                            infinite: true,
                            centerPadding: '90px',

                        }
                    },
                    {
                        breakpoint: 750,
                        settings: {
                            slidesToShow: 1,
                            infinite: true,
                            centerPadding: '60px',

                        }
                    },
                    {
                        breakpoint: 520,
                        settings: {
                            slidesToShow: 1,
                            infinite: true,
                            centerPadding: '10px',

                        }
                    }
                ]
            });
            $slider.on("beforeChange", function (event, slick, current_slide, next_slide) {
                let $all_slides = $(this).find(".slick-slide");
                $all_slides.removeClass("slick-next-active");
                $(slick.$slides[next_slide]).addClass("slick-next-active");
            });

            $slider.on("breakpoint", function (event, slick, breakpoint) {
                console.log(breakpoint)
            })
        }
    };


    dw.scroll_to_link = function () {
        $("a.scroll-to").click(function (e) {
            e.preventDefault();
            let $target = $($(this).attr("href"));
            if ($target.length) {
                $('html, body').animate({
                    scrollTop: $($(this).attr("href")).offset().top
                }, 1000);
            } else {
                window.location.href = "./index.html" + $(this).attr("href");
            }
        });
    };


    dw.scroll_spy = function () {
        $(window).bind('scroll', function () {
            let elems = $(".section, footer");
            let window_top_position = $(window).scrollTop();
            let window_bottom_position = (window_top_position + $(window).height());

            elems.each(function () {
                let $section = $(this);
                let section_top_position = $section.offset().top - 200;
                let section_bottom_position = section_top_position + $section.height();


                if (window_top_position >= section_top_position && window_top_position <= section_bottom_position) {
                    let id = $(this).attr('id');
                    let navElem = $('a[href="#' + id + '"]');
                    navElem.addClass('is-active').siblings().removeClass('is-active');
                }

                let $scroll_to_top = $("a#scroll-to-top");
                let scroll_to_top_button_offset = -220;
                if ((section_bottom_position >= window_top_position - scroll_to_top_button_offset) &&
                    (section_top_position <= window_bottom_position + scroll_to_top_button_offset)) {
                    let scroll_to_top_style = $(this).data('scroll-to-top-style');
                    if (scroll_to_top_style === "dark") {
                        if (!$scroll_to_top.hasClass("dark")) {
                            $scroll_to_top.addClass("dark");
                        }
                    } else {
                        $scroll_to_top.removeClass("dark");
                    }
                }

            });
        });
    };


    dw.scroll_to_top = function () {
        let $back_to_top = $("#scroll-to-top");
        $back_to_top.on("click", function (e) {
            e.stopPropagation();
            e.preventDefault();
            $html.animate({
                scrollTop: 0
            }, $window.scrollTop() / 3, "easeInOutQuart");
        });

        let $holder = $(".scroll-to-top-holder");
        $window.on("scroll", function () {
            let thisScrollTop = $document.scrollTop();
            if (thisScrollTop > 1000) {
                $holder.addClass("appear");
            } else {
                $holder.removeClass("appear");
            }
        });
    };


    dw.mobile_menu = function () {
        let $document_body = $(document.body);
        let $show_menu_button = $("#show-menu-button");
        let $menu = $("#mobile-menu");
        let menu_anim_time = 400;


        function show_menu() {
            $document_body.addClass("mobile-menu-show");
            $show_menu_button.addClass("active");
            $menu.addClass("show");

            setTimeout(function () {
                $document_body.addClass("mobile-three-before");
                $document_body.addClass("mobile-three");
            }, menu_anim_time);
        }


        function hide_menu() {
            $document_body.removeClass("mobile-three-before");
            $document_body.removeClass("mobile-menu-show");

            setTimeout(function () {
                $document_body.removeClass("mobile-three");
                $show_menu_button.removeClass("active");
                $menu.removeClass("show");
            }, menu_anim_time / 2);
        }


        $show_menu_button.on("click", function () {
            if (!$document_body.hasClass("mobile-menu-show")) {
                show_menu();
            } else {
                hide_menu();
            }
        });

        let $mobile_menu_item = $(".mobile-menu-item");
        $mobile_menu_item.on("click", function () {
            setTimeout(function () {
                hide_menu();
            }, menu_anim_time);
        });

    };


    dw.portfolio = function () {
        let $portfolio = $("#portfolio-grid");
        let $items = $portfolio.find(".portfolio-item");
        let $filters = $("#portfolio-filters");

        if ($portfolio.length) {
            $portfolio.waitForImages(function () {
                $filters.on("click", "a.portfolio-filter", function (e) {
                    e.preventDefault();
                    let $this = $(this);
                    let target = $this.attr('href');
                    $this.parent().siblings().find("a").removeClass('is-active');
                    $this.addClass("is-active");
                    filter($items, target)
                });


                function filter(items, filter) {
                    items = items || '*';

                    let matches = [];
                    let hiddenMatched = [];
                    let visibleUnmatched = [];


                    for (let i = 0; i < items.length; i++) {
                        let item = items[i];
                        let isMatched = !!$(item).data("filter").includes(filter);

                        if (isMatched) {
                            matches.push(item);
                        }

                        if (isMatched && item.isHidden) {
                            hiddenMatched.push(item);
                        } else if (!isMatched && !item.isHidden) {
                            visibleUnmatched.push(item);
                        }
                    }

                    $(visibleUnmatched).hide();
                    $(matches).show();
                    $portfolio.masonry('layout');
                }

                $portfolio.masonry({
                    itemSelector: '.portfolio-item',
                    columnWidth: '.grid-sizer',
                    percentPosition: true,
                    transitionDuration: '1s'
                });

                $portfolio.masonry('layout');
            })
        }
    };


    dw.on_scroll_animation = function () {
        let $animated_sections = $(".animated-section");

        if ($animated_sections.length) {

            $animated_sections.each(function () {
                let $elements = $(this).find("[data-anim-type]");
                $elements.css("opacity", 0);
            });


            let on_scroll_animation = function () {

                $animated_sections = $(".animated-section:not(.animated)");

                let window_top_position = $window.scrollTop();
                let window_bottom_position = (window_top_position + window_height);

                $animated_sections.each(function () {
                    let $section = $(this),
                        section_height = $section.outerHeight(),
                        section_top_position = $section.offset().top,
                        section_bottom_position = (section_top_position + section_height);

                    if ((section_bottom_position >= window_top_position) &&
                        (section_top_position <= window_bottom_position)) {


                        let $elements = $section.find("[data-anim-type]");
                        $elements.each(function () {
                            let $element = $(this);

                            let num = $element.data("anim-queue");

                            let anim = $element.data("anim-type");
                            if ($element.data('anim-queue')) {
                                window.setTimeout(function () {
                                    $element.addClass('animated ' + anim);
                                }, parseInt(num, 10) * 100);
                            } else {
                                $element.addClass('animated ' + anim);
                            }
                        });

                        $section.addClass('animated');
                    }
                });
            };


            $window.on('scroll', function () {
                on_scroll_animation();
            });
            on_scroll_animation();
        }
    };


    dw.single_project_popups = function () {
        let $image_wrapper = $(".single-project-image-wrapper");
        if ("undefined" !== typeof $.magnificPopup && $image_wrapper.length) {
            $image_wrapper.magnificPopup({
                delegate: 'a',
                type: 'image',
                tLoading: 'Loading image ...',
                mainClass: 'mfp-img-mobile',
                gallery: {
                    enabled: true,
                    navigateByImgClick: true,
                    preload: [0, 1]
                },
                image: {
                    tError: '<a href="%url%">The image #%curr%</a> could not be loaded.',
                },
            });
        }
    };


    dw.custom_cursor = {
        _x: 0,
        _y: 0,
        __x: (window.innerWidth / 2),
        __y: (window.innerHeight / 2),
        _is_visible: false,
        _cursor_follower_delay: 6,
        _cursor_follower_margin: 0,
        _cursor_follower_selector: null,

        init: function () {
            this._cursor_follower_selector = document.getElementById('cursor-follower');
            this._cursor_follower_selector.style.transform = 'translate(-50%, -50%) scale(1)';
            this.setup_cursor();
            this.animate_cursor_follower();
        },

        toggle_visibility: function () {
            let self = this;
            if (self._is_visible) {
                self._cursor_follower_selector.style.opacity = 1;
            } else {
                self._cursor_follower_selector.style.opacity = 0;
            }
        },

        setup_cursor: function () {
            let self = this;

            document.addEventListener('mousemove', function (e) {
                self._is_visible = true;
                self.toggle_visibility();
                self.__x = e.clientX;
                self.__y = e.clientY;
            });

            document.querySelectorAll('[data-cursor-style="dark"]').forEach(function (el) {
                el.addEventListener('mouseover', function () {
                    self._cursor_follower_selector.classList.add("cursor-follower-dark");
                });
                el.addEventListener('mouseout', function () {
                    self._cursor_follower_selector.classList.remove("cursor-follower-dark");
                });
            });

            document.querySelectorAll('[data-cursor-effect="hover"]').forEach(function (el) {
                el.addEventListener('mouseover', function () {
                    self._cursor_follower_selector.classList.add("cursor-follower-hover-effect");
                });
                el.addEventListener('mouseout', function () {
                    self._cursor_follower_selector.classList.remove("cursor-follower-hover-effect");
                });
            });

            document.querySelectorAll('[data-cursor-effect="blend"]').forEach(function (el) {
                el.addEventListener('mouseover', function () {
                    self._cursor_follower_selector.classList.add("cursor-follower-blend-effect");
                });
                el.addEventListener('mouseout', function () {
                    self._cursor_follower_selector.classList.remove("cursor-follower-blend-effect");
                });
            });

            document.querySelectorAll('[data-cursor-effect="exclusion"]').forEach(function (el) {
                el.addEventListener('mouseover', function () {
                    self._cursor_follower_selector.classList.add("cursor-follower-exclusion-effect");
                });
                el.addEventListener('mouseout', function () {
                    self._cursor_follower_selector.classList.remove("cursor-follower-exclusion-effect");
                });
            });

            document.addEventListener('mouseleave', function () {
                self._is_visible = false;
                self.toggle_visibility();
            });

            document.addEventListener('mouseenter', function () {
                self._is_visible = true;
                self.toggle_visibility();

            });
        },

        animate_cursor_follower: function () {
            let self = this;
            self._x += (self.__x - self._x - self._cursor_follower_margin) / self._cursor_follower_delay;
            self._y += (self.__y - self._y - self._cursor_follower_margin) / self._cursor_follower_delay;
            self._cursor_follower_selector.style.top = self._y + 'px';
            self._cursor_follower_selector.style.left = self._x + 'px';
            requestAnimationFrame(this.animate_cursor_follower.bind(self));
        }
    };





    $(function () {

        if ("undefined" !== typeof window.THREE && $("#three-block").length) {
            page_has_three = true;
            $(document.body).addClass("page-has-three");
        }

        let $responsive_indicator = "<div id='responsive-indicator'></div>";
        $("body").prepend($responsive_indicator);

        if (dw.settings.custom_cursor) {
            dw.custom_cursor.init();
        }

        if (dw.settings.on_scroll_animation) {
            dw.on_scroll_animation();
        }

        dw.team_slider();
        dw.scroll_to_link();
        dw.scroll_to_top();
        dw.scroll_spy();
        dw.mobile_menu();
        dw.portfolio();
        dw.single_project_popups();

        if(page_has_three){
            dw.three();
        }

    });

})(jQuery);
